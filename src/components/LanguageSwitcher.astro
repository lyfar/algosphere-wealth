---
/**
 * Language switcher — compact dropdown for 5 languages.
 */
const langs = [
  { id: 'hy', label: 'ՀY' },
  { id: 'en', label: 'EN' },
  { id: 'ru', label: 'RU' },
  { id: 'fr', label: 'FR' },
  { id: 'ar', label: 'AR' },
];
---

<div class="lang-switcher relative ml-3">
  <button
    id="lang-toggle"
    class="flex items-center gap-1.5 text-[9px] tracking-[0.15em] uppercase font-medium px-3 py-1.5 rounded border border-gold-400/20 hover:border-gold-400/40 transition-all duration-300 text-gold-accent"
    aria-label="Language"
  >
    <span id="lang-current">ՀY</span>
    <svg class="w-3 h-3 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
    </svg>
  </button>

  <div id="lang-dropdown" class="absolute right-0 top-full mt-2 py-1.5 rounded-lg border border-gold-400/15 bg-bg-primary/95 backdrop-blur-xl shadow-xl opacity-0 pointer-events-none transition-all duration-300 translate-y-[-4px] z-50 min-w-[52px]">
    {langs.map((l) => (
      <button
        id={`lang-${l.id}`}
        class="lang-btn block w-full text-center text-[9px] tracking-[0.15em] uppercase font-medium px-3 py-1.5 transition-all duration-200 hover:text-gold-400 text-nav-text"
        data-lang={l.id}
        data-label={l.label}
      >
        {l.label}
      </button>
    ))}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('lang-toggle');
    const dropdown = document.getElementById('lang-dropdown');
    const current = document.getElementById('lang-current');
    let open = false;

    function showDropdown() {
      open = true;
      dropdown!.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-[-4px]');
      dropdown!.classList.add('opacity-100', 'pointer-events-auto', 'translate-y-0');
    }

    function hideDropdown() {
      open = false;
      dropdown!.classList.add('opacity-0', 'pointer-events-none', 'translate-y-[-4px]');
      dropdown!.classList.remove('opacity-100', 'pointer-events-auto', 'translate-y-0');
    }

    toggle?.addEventListener('click', (e) => {
      e.stopPropagation();
      open ? hideDropdown() : showDropdown();
    });

    document.addEventListener('click', () => { if (open) hideDropdown(); });

    // Update current label when language changes
    document.querySelectorAll('.lang-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        const label = (btn as HTMLElement).dataset.label;
        if (current && label) current.textContent = label;
        hideDropdown();
        // Mark active
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('text-gold-400'));
        btn.classList.add('text-gold-400');
      });
    });

    // Set initial label from saved lang
    const saved = localStorage.getItem('algosphere-lang') || 'hy';
    const activeBtn = document.getElementById(`lang-${saved}`) as HTMLElement;
    if (activeBtn && current) {
      current.textContent = activeBtn.dataset.label || 'ՀY';
      activeBtn.classList.add('text-gold-400');
    }
  });
</script>
